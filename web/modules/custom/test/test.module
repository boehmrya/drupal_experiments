<?php

use Drupal\Core\Render\Markup;
use Drupal\block_content\Entity\BlockContent;

/**
 * Implements hook_theme().
 */
function test_theme($existing, $type, $theme, $path) {
  return [
    'my_template' => [
      'variables' => [
        'test_var' => [],
      ],
    ],
  ];
}

function test_block_content_view_alter(array &$build, BlockContent $custom_block) {
  //dpm($build);
  //dpm($custom_block);

  //$build['body'][0]['#text'] = '<p>New Text</p>';

  if ($build['#view_mode'] == 'full') {

    // Change its weight.
    //$build['an_additional_field']['#weight'] = -10;

    // Add a #post_render callback to act on the rendered HTML of the entity.
    $build['#post_render'][] = '_test_block_post_render';
  }
}

function _test_block_post_render($markup, $build) {
  $markup = $markup . '<p>Test</p>';
  return $markup;
  dpm($markup);
}
